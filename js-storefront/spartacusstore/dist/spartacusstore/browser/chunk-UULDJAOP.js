import{H as Ct,M as ft,m as lt}from"./chunk-OB3MC34I.js";import{C as it,Fa as dt,Ga as ut,S as nt,U as ot,V as rt,X as at,Y as st,ba as pt,e as J,g as X,j as Z,ka as ct,l as tt,p as et,zb as mt}from"./chunk-OOBMFFZN.js";import{Ac as G,Bb as h,Cb as S,Ce as W,Da as x,Db as k,Ea as v,Gb as N,Hb as Q,I as O,Ib as L,Q as _,Qa as q,Qe as $,Ra as r,Rb as u,Sa as l,Sb as m,Ua as F,Zf as Y,_f as z,ab as C,ac as M,bb as R,cb as a,de as K,ib as d,jb as f,kb as g,lb as P,mb as B,mc as j,ob as T,pc as V,qa as w,qb as I,rb as p,ta as A,uc as U,v as b,xa as E,ya as D,zd as H}from"./chunk-M6I5A6DT.js";function _t(i,o){if(i&1&&g(0,"cx-item-counter",9),i&2){let n=p(3);a("max",n.maxQuantity)("control",n.addToCartForm.get("quantity"))}}function xt(i,o){if(i&1&&(d(0,"span"),h(1),f()),i&2){let n=p(3);r(),S(n.getInventory())}}function vt(i,o){if(i&1&&(d(0,"div",5)(1,"label"),h(2),u(3,"cxTranslate"),f(),d(4,"div",6),C(5,_t,1,2,"cx-item-counter",7),d(6,"span",8),C(7,xt,2,1,"span",3),u(8,"async"),h(9),u(10,"cxTranslate"),u(11,"cxTranslate"),f()()()),i&2){let n=p(2);r(2),S(m(3,4,"addToCart.quantity")),r(3),a("ngIf",n.hasStock),r(2),a("ngIf",m(8,6,n.showInventory$)),r(2),k(" ",n.hasStock?m(10,8,"addToCart.inStock"):m(11,10,"addToCart.outOfStock"),"")}}function gt(i,o){}function Tt(i,o){if(i&1){let n=T();P(0),C(1,gt,0,0,"ng-template",10),L("cxComponentRefChange",function(t){x(n);let s=p(2);return Q(s.pickupOptionCompRef,t)||(s.pickupOptionCompRef=t),v(t)}),B()}if(i&2){let n=p(2);r(),a("cxOutlet",n.CartOutlets.ADD_TO_CART_PICKUP_OPTION),N("cxComponentRef",n.pickupOptionCompRef)}}function It(i,o){if(i&1&&(d(0,"span",14),g(1,"cx-icon",15),f()),i&2){let n=p(3);r(),a("type",n.iconTypes.REPEAT)}}function St(i,o){if(i&1&&(d(0,"button",11),C(1,It,2,1,"span",12),u(2,"cxTranslate"),d(3,"span",13),u(4,"cxTranslate"),u(5,"cxTranslate"),h(6),u(7,"cxTranslate"),f()()),i&2){let n,e,t=p(2);a("ngClass",t.options!=null&&t.options.displayAddToCart?"btn btn-tertiary":"btn btn-primary btn-block")("disabled",t.quantity<=0||t.quantity>t.maxQuantity),r(),a("ngIf",(t.options==null?null:t.options.addToCartString)===m(2,6,"addToCart.buyItAgain")),r(2),a("ngClass",(t.options==null?null:t.options.addToCartString)===m(4,8,"addToCart.buyItAgain")?"buyItAgainLink":""),R("aria-label",(n=t.options==null?null:t.options.addToCartString)!==null&&n!==void 0?n:m(5,10,"addToCart.addToCart")),r(3),k(" ",(e=t.options==null?null:t.options.addToCartString)!==null&&e!==void 0?e:m(7,12,"addToCart.addToCart")," ")}}function kt(i,o){if(i&1){let n=T();d(0,"form",1),I("submit",function(){x(n);let t=p();return v(t.addToCart())}),C(1,vt,12,12,"div",2)(2,Tt,2,2,"ng-container",3)(3,St,8,14,"button",4),f()}if(i&2){let n=p();a("formGroup",n.addToCartForm),r(),a("ngIf",n.showQuantity),r(),a("ngIf",n.hasStock),r(),a("ngIf",n.hasStock)}}var bt=(()=>{let o=class o{handleKeyboardEvent(e){if(!this.featureConfigService?.isEnabled("a11yQuantityOrderTabbing"))return;let t=e.target,s=t.ariaLabel==="Quantity"&&t.tagName==="INPUT";e.key==="Enter"&&s&&e.preventDefault()}constructor(e,t,s,y,c,ht){this.currentProductService=e,this.cd=t,this.activeCartService=s,this.component=y,this.eventService=c,this.productListItemContext=ht,this.showQuantity=!0,this.hasStock=!1,this.inventoryThreshold=!1,this.showInventory$=this.component?.data$.pipe(b(yt=>yt.inventoryDisplay)),this.quantity=1,this.addToCartForm=new X({quantity:new Z(1,{updateOn:"blur"})}),this.CartOutlets=ft,this.iconTypes=rt,this.featureConfigService=A($,{optional:!0})}ngOnInit(){this.product?(this.productCode=this.product.code??"",this.setStockInfo(this.product),this.cd.markForCheck()):this.productCode?(this.quantity=1,this.hasStock=!0,this.cd.markForCheck()):this.subscription=(this.productListItemContext?this.productListItemContext.product$:this.currentProductService.getProduct()).pipe(O(K)).subscribe(e=>{this.productCode=e.code??"",this.setStockInfo(e),this.cd.markForCheck()})}setStockInfo(e){this.quantity=1,this.addToCartForm.controls.quantity.setValue(1),this.hasStock=e.stock?.stockLevelStatus!=="outOfStock",this.inventoryThreshold=e.stock?.isValueRounded??!1,this.hasStock&&e.stock?.stockLevel&&(this.maxQuantity=e.stock.stockLevel),this.productListItemContext&&(this.showQuantity=!1)}getInventory(){if(this.hasStock){let e=this.maxQuantity?this.maxQuantity.toString():"";return this.inventoryThreshold?e+"+":e}else return""}updateCount(e){this.quantity=e}addToCart(){let e=this.addToCartForm.get("quantity")?.value;!this.productCode||e<=0||(this.pickupOptionCompRef instanceof F&&this.pickupOptionCompRef.instance.intendedPickupLocation$.pipe(_(1)).subscribe(t=>{this.pickupStore=t?.pickupOption==="pickup"?t.name:void 0}),this.activeCartService.getEntries().pipe(_(1)).subscribe(t=>{this.activeCartService.addEntry(this.productCode,e,this.pickupStore),this.eventService.dispatch(this.createCartUiEventAddToCart(this.productCode,e,t.length,this.pickupStore))}))}createCartUiEventAddToCart(e,t,s,y){let c=new lt;return c.productCode=e,c.quantity=t,c.numberOfEntriesBeforeAdd=s,c.pickupStoreName=y,c}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}};o.\u0275fac=function(t){return new(t||o)(l(ct),l(M),l(Ct),l(pt),l(W),l(mt,8))},o.\u0275cmp=E({type:o,selectors:[["cx-add-to-cart"]],hostBindings:function(t,s){t&1&&I("keydown",function(c){return s.handleKeyboardEvent(c)},!1,q)},inputs:{productCode:"productCode",showQuantity:"showQuantity",options:"options",pickupStore:"pickupStore",product:"product"},decls:1,vars:1,consts:[[3,"formGroup","submit",4,"ngIf"],[3,"submit","formGroup"],["class","quantity",4,"ngIf"],[4,"ngIf"],["type","submit",3,"ngClass","disabled",4,"ngIf"],[1,"quantity"],[1,"cx-counter-stock"],[3,"max","control",4,"ngIf"],[1,"info"],[3,"max","control"],[3,"cxComponentRefChange","cxOutlet","cxComponentRef"],["type","submit",3,"ngClass","disabled"],["class","repeat-icon",4,"ngIf"],[3,"ngClass"],[1,"repeat-icon"],[3,"type"]],template:function(t,s){t&1&&C(0,kt,4,4,"form",0),t&2&&a("ngIf",s.productCode)},dependencies:[j,V,tt,J,et,at,dt,nt,U,Y],encapsulation:2,changeDetection:0});let i=o;return i})(),Kt=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=D({type:o}),o.\u0275inj=w({providers:[H({cmsComponents:{ProductAddToCartComponent:{component:bt,data:{inventoryDisplay:!1}}}})],imports:[G,it,z,st,ut,ot]});let i=o;return i})();export{bt as a,Kt as b};
