import{c as Se}from"./chunk-QRJGJFDR.js";import{N as fe,V as y,ga as j}from"./chunk-OOBMFFZN.js";import{Ac as ie,Ee as W,Fa as q,Fe as _,Ge as z,Kd as re,Lc as L,Ld as se,N as J,Od as h,Pd as C,Q as D,Sd as oe,Vd as N,Wd as O,Xd as I,Yb as ee,Yc as P,a as Y,ae as k,be as H,bf as ue,cf as de,d as K,e as E,ee as F,ef as he,fc as te,fe as ne,ff as le,fg as ge,ge as ae,gg as g,ha as Q,i as B,le as ce,me as l,pa as c,pe as $,qa as v,qe as x,r as X,s as R,sa as o,se as M,u as Z,v as A,vd as b,w,ya as p,zd as U}from"./chunk-M6I5A6DT.js";var Ke=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=c({token:e,factory:function(r){let s=null;return r?s=new(r||e):s=o(b),s},providedIn:"root"});let t=e;return t})(),ve="asm_enabled",pe=(()=>{let e=class e{constructor(i,r,s,a){this.location=i,this.winRef=r,this.launchDialogService=s,this.featureModules=a}load(){this.isEnabled()&&this.addUi()}isEnabled(){return this.isLaunched()&&!this.isUsedBefore()&&this.winRef.localStorage&&this.winRef.localStorage.setItem(ve,"true"),this.isLaunched()||this.isUsedBefore()||this.isEmulateInURL()}isLaunched(){let i=this.location.path().split("?")[1];return!!i&&i.split("&").includes("asm=true")}isEmulateInURL(){return this.location.path().indexOf("assisted-service/emulate?")>0}isUsedBefore(){return this.winRef.localStorage?this.winRef.localStorage.getItem(ve)==="true":!1}addUi(){this.featureModules.resolveFeature("asm").subscribe(()=>this.launchDialogService.launch("ASM"))}};e.\u0275fac=function(r){return new(r||e)(o(te),o(N),o(fe),o(ge))},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),me=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=p({type:e}),e.\u0275inj=v({providers:[{provide:ee,useFactory:Ee,deps:[pe],multi:!0}],imports:[ie,j]});let t=e;return t})();function Ee(t){return()=>{t.load()}}var T=function(t){return t.START_SESSION="START_SESSION",t.ORDER_HISTORY="ORDER_HISTORY",t.ACTIVE_CART="ACTIVE_CART",t.CUSTOMER_360="CUSTOMER_360",t}(T||{}),Re={asm:{agentSessionTimer:{startingDelayInSeconds:600},customerSearch:{maxResults:20},customerList:{pageSize:5,showAvatar:!0,columns:[{headerLocalizationKey:"asm.customerList.tableHeader.customer",renderer:t=>t?.name??"",actionType:T.START_SESSION},{headerLocalizationKey:"asm.customerList.tableHeader.email",renderer:t=>t?.uid??""},{headerLocalizationKey:"asm.customerList.tableHeader.phone",renderer:t=>t?.defaultAddress?.phone??""},{headerLocalizationKey:"asm.customerList.tableHeader.account",renderer:t=>t?.orgUnit?.name??""},{headerLocalizationKey:"asm.customerList.tableHeader.activeCart",icon:{symbol:y.CART,captionLocalizationKey:"asm.customerList.tableHeader.viewActiveCart"},actionType:T.ACTIVE_CART},{headerLocalizationKey:"asm.customerList.tableHeader.orders",icon:{symbol:y.C360_INVOICE,captionLocalizationKey:"asm.customerList.tableHeader.viewOrders"},actionType:T.ORDER_HISTORY},{headerLocalizationKey:"asm.customerList.tableHeader.customer360",icon:{symbol:y.C360_CIRCLE_USER,captionLocalizationKey:"asm.customerList.tableHeader.viewCustomer360"},actionType:T.CUSTOMER_360}]},userIdHttpHeader:{enable:!0}}},Ae=(()=>{let e=class e{constructor(i,r,s){this.config=i,this.userIdService=r,this.userIdConstants=s,this.userIdHeader="sap-commerce-cloud-user-id",this.uniqueUserIdConstants=new Set(Object.values(s))}intercept(i,r){if(!this.config.asm?.userIdHttpHeader?.enable)return r.handle(i);let s=i.context.get(ue),a;if(typeof s.sendUserIdAsHeader=="string")a=R(s.sendUserIdAsHeader);else if(s.sendUserIdAsHeader)a=this.userIdService.takeUserId().pipe(A(n=>this.uniqueUserIdConstants.has(n)?void 0:n));else return r.handle(i);return a.pipe(J(n=>{if(n){let d=i.clone({headers:i.headers.set(this.userIdHeader,n)});return r.handle(d)}else return r.handle(i)}))}};e.\u0275fac=function(r){return new(r||e)(o(b),o(C),o(de))},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),u=function(t){return t.CSAgent="CSAgent",t.User="User",t}(u||{}),G=(()=>{let e=class e extends I{constructor(){super(...arguments),this._tokenTarget$=new B(u.User)}getTokenTarget(){return this._tokenTarget$}setTokenTarget(i){this._tokenTarget$.next(i)}getEmulatedUserToken(){return this.emulatedUserToken}setEmulatedUserToken(i){this.emulatedUserToken=i}switchTokenTargetToCSAgent(){this._tokenTarget$.next(u.CSAgent)}switchTokenTargetToUser(){this._tokenTarget$.next(u.User)}clearEmulatedUserToken(){this.emulatedUserToken=void 0}};e.\u0275fac=(()=>{let i;return function(s){return(i||(i=q(e)))(s||e)}})(),e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),Le=(()=>{let e=class e{constructor(i,r,s,a,n,d){this.authService=i,this.authStorageService=r,this.userIdService=s,this.oAuthLibWrapperService=a,this.store=n,this.userAccountFacade=d}authorizeCustomerSupportAgent(i,r){return E(this,null,function*(){let s,a;this.userAccountFacade.get().subscribe(n=>a=n?.customerId).unsubscribe(),this.authStorageService.getToken().subscribe(n=>s=n).unsubscribe(),this.authStorageService.switchTokenTargetToCSAgent();try{yield this.oAuthLibWrapperService.authorizeWithPasswordFlow(i,r),this.store.dispatch(new h.Logout),a!==void 0&&s!==void 0?(this.userIdService.setUserId(a),this.authStorageService.setEmulatedUserToken(s),this.store.dispatch(new h.Login)):(this.userIdService.setUserId(se),this.authStorageService.clearEmulatedUserToken())}catch{this.authStorageService.switchTokenTargetToUser()}})}startCustomerEmulationSession(i){this.authStorageService.clearEmulatedUserToken(),this.store.dispatch(new h.Logout),this.userIdService.setUserId(i),this.store.dispatch(new h.Login)}isCustomerSupportAgentLoggedIn(){return w([this.authStorageService.getToken(),this.authStorageService.getTokenTarget()]).pipe(A(([i,r])=>!!(i?.access_token&&r===u.CSAgent)))}isCustomerEmulated(){return this.userIdService.isEmulated()}getCustomerSupportAgentTokenLoading(){return R(!1)}logoutCustomerSupportAgent(){return E(this,null,function*(){let i=this.authStorageService.getEmulatedUserToken(),r;this.userIdService.isEmulated().subscribe(s=>r=s).unsubscribe(),yield this.oAuthLibWrapperService.revokeAndLogout(),this.store.dispatch({type:"[Auth] Logout Customer Support Agent"}),this.authStorageService.setTokenTarget(u.User),r&&i?(this.store.dispatch(new h.Logout),this.authStorageService.setToken(i),this.userIdService.setUserId(re),this.authStorageService.clearEmulatedUserToken(),this.store.dispatch(new h.Login)):this.authService.logout()})}};e.\u0275fac=function(r){return new(r||e)(o(l),o(G),o(C),o(O),o(P),o(Se))},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),be=(()=>{let e=class e extends z{constructor(i,r,s,a,n,d,f,S){super(i,r,a,n,f,d,S),this.authService=i,this.authStorageService=r,this.csAgentAuthService=s,this.oAuthLibWrapperService=a,this.routingService=n,this.globalMessageService=d,this.occEndpointsService=f,this.authRedirectService=S}shouldAddAuthorizationHeader(i){return super.shouldAddAuthorizationHeader(i)||this.isCSAgentTokenRequest(i)}shouldCatchError(i){return super.shouldCatchError(i)||this.isCSAgentTokenRequest(i)}alterRequest(i,r){let s=!!this.getAuthorizationHeader(i),a=this.isCSAgentTokenRequest(i),n=super.alterRequest(i,r);return!s&&a?(n=i.clone({setHeaders:Y({},this.createAuthorizationHeader(r))}),x.removeHeader($,n)):n}isCSAgentTokenRequest(i){return!!x.getInterceptorParam($,i.headers)}handleExpiredRefreshToken(){this.csAgentAuthService.isCustomerSupportAgentLoggedIn().pipe(D(1)).subscribe(i=>{i?(this.authService.setLogoutProgress(!0),this.csAgentAuthService.logoutCustomerSupportAgent(),this.globalMessageService.add({key:"asm.csagentTokenExpired"},W.MSG_TYPE_ERROR)):super.handleExpiredRefreshToken()})}};e.\u0275fac=function(r){return new(r||e)(o(l),o(I),o(Le),o(O),o(k),o(_),o(M),o(H))},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),Ue=(()=>{let e=class e extends l{constructor(i,r,s,a,n,d,f,S){super(i,r,s,a,n,f,S),this.store=i,this.userIdService=r,this.oAuthLibWrapperService=s,this.authStorageService=a,this.authRedirectService=n,this.globalMessageService=d,this.routingService=f,this.authMultisiteIsolationService=S}canUserLogin(){let i,r;return this.authStorageService.getToken().subscribe(s=>r=s).unsubscribe(),this.authStorageService.getTokenTarget().subscribe(s=>i=s).unsubscribe(),!(r?.access_token&&i===u.CSAgent)}warnAboutLoggedCSAgent(){this.globalMessageService.add({key:"asm.auth.agentLoggedInError"},W.MSG_TYPE_ERROR)}loginWithCredentials(i,r){return E(this,null,function*(){this.canUserLogin()?yield K(e.prototype,this,"loginWithCredentials").call(this,i,r):this.warnAboutLoggedCSAgent()})}loginWithRedirect(){return this.canUserLogin()?(super.loginWithRedirect(),!0):(this.warnAboutLoggedCSAgent(),!1)}coreLogout(){return Z(this.userIdService.isEmulated().pipe(D(1),Q(i=>i?(this.authStorageService.clearEmulatedUserToken(),this.userIdService.clearUserId(),this.store.dispatch(new h.Logout),R(!0)):X(super.coreLogout()))))}isUserLoggedIn(){return w([this.authStorageService.getToken(),this.userIdService.isEmulated(),this.authStorageService.getTokenTarget()]).pipe(A(([i,r,s])=>!!i?.access_token&&(s===u.User||s===u.CSAgent&&r)))}};e.\u0275fac=function(r){return new(r||e)(o(P),o(C),o(O),o(G),o(H),o(_),o(k),o(ce))},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),Be=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=p({type:e}),e.\u0275inj=v({providers:[U(Re),{provide:I,useExisting:G},{provide:l,useExisting:Ue},{provide:z,useExisting:be},{provide:L,useExisting:Ae,multi:!0}],imports:[me]});let t=e;return t})(),m="asm",Xe=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=c({token:e,factory:()=>g({facade:e,feature:m,methods:["bindCart"]}),providedIn:"root"});let t=e;return t})(),Ze=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=c({token:e,factory:()=>g({facade:e,feature:m,methods:["createCustomer"]}),providedIn:"root"});let t=e;return t})(),Je=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=c({token:e,factory:()=>g({facade:e,feature:m,methods:["getCustomerLists","getCustomerListsState","customerListCustomersSearch","getCustomerListCustomersSearchResults","getCustomerListCustomersSearchResultsLoading","customerListCustomersSearchReset","getCustomerListCustomersSearchResultsError"]}),providedIn:"root"});let t=e;return t})(),Qe=(()=>{let e=class e{constructor(i,r,s){this.routingService=i,this.winRef=r,this.asmEnablerService=s,this.searchParams=new URLSearchParams(this.winRef?.location?.search)}isEmulateInURL(){return this.asmEnablerService?.isEmulateInURL()||!1}getSearchParameter(i){return this.searchParams.get(i)??void 0}handleNavigation(i=this.getParamsInUrl()){i.cartType==="active"?this.routingService.go({cxRoute:"cart"}):i.cartType==="saved"&&i.cartId?this.routingService.go("my-account/saved-cart/"+i.cartId):i.orderId?this.routingService.go({cxRoute:"orderDetails",params:{code:i.orderId}}):i.ticketId&&this.routingService.go({cxRoute:"supportTicketDetails",params:{ticketCode:i.ticketId}})}getParamsInUrl(){let i={customerId:this.getSearchParameter("customerId"),orderId:this.getSearchParameter("orderId"),ticketId:this.getSearchParameter("ticketId"),cartId:this.getSearchParameter("cartId"),cartType:this.getSearchParameter("cartType")};return Object.fromEntries(Object.entries(i).filter(([r,s])=>!!s))}};e.\u0275fac=function(r){return new(r||e)(o(k),o(N),o(pe))},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var V="asmCustomer360",Ce="asmCustomer360Core",Oe=(()=>{let e=class e{constructor(i,r,s,a){this.languageService=i,this.currencyService=r,this.occEndpoints=s,this.config=a,this.activeLang=F(this.config,ne),this.activeCurr=F(this.config,ae),this.languageService.getActive().subscribe(n=>this.activeLang=n),this.currencyService.getActive().subscribe(n=>{this.activeCurr=n})}intercept(i,r){return i.url.includes(this.occEndpoints.getBaseUrl({prefix:!1,baseSite:!1}))&&i.url.includes("/assistedservicewebservices/")&&(i=i.clone({setParams:{lang:this.activeLang??"",curr:this.activeCurr??""}})),r.handle(i)}};e.\u0275fac=function(r){return new(r||e)(o(he),o(le),o(M),o(oe))},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),ot=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=p({type:e}),e.\u0275inj=v({providers:[U({featureModules:{[V]:{dependencies:[m]},[Ce]:V}}),{provide:L,useExisting:Oe,multi:!0}],imports:[j]});let t=e;return t})(),nt=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=c({token:e,factory:()=>g({facade:e,feature:V,methods:["get360Data"]}),providedIn:"root"});let t=e;return t})();var ke=function(t){return t.REVIEW_LIST="c360ReviewList",t.STORE_LOCATION="c360StoreLocation",t.PRODUCT_INTEREST_LIST="c360CustomerProductInterestList",t.SUPPORT_TICKET_LIST="c360TicketList",t.CUSTOMER_PROFILE="c360CustomerProfile",t.ACTIVE_CART="c360Cart",t.SAVED_CART="c360SavedCart",t.OVERVIEW="c360Overview",t.ACTIVITY_LIST="c360ActivityList",t.COUPON_LIST="c360CouponList",t.PROMOTION_LIST="c360PromotionList",t.CUSTOMER_COUPON_LIST="c360CustomerCouponList",t}(ke||{}),Me=function(t){return t.VISA="visa",t.MASTER="master",t.MASTERCARD_EUROCARD="mastercard_eurocard",t.DINERS="diners",t.AMEX="amex",t}(Me||{}),ye=function(t){return t.ARROW_LEFT="ArrowLeft",t.ARROW_RIGHT="ArrowRight",t.ARROW_DOWN="ArrowDown",t.ARROW_UP="ArrowUp",t.HOME="Home",t.END="End",t.PAGE_DOWN="PageDown",t.PAGE_UP="PageUp",t}(ye||{}),je=function(t){return t.NAVIGATE="NAVIGATE",t}(je||{});export{Ke as a,ve as b,pe as c,T as d,G as e,Le as f,Be as g,m as h,Xe as i,Ze as j,Je as k,Qe as l,V as m,ot as n,nt as o,ke as p,Me as q,ye as r,je as s};
