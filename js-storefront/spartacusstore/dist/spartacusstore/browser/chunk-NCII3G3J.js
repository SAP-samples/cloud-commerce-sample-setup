import{c as we,d as z,e as Ct,f as kt}from"./chunk-QRJGJFDR.js";import{B as Te,C as Ie,Da as Pe,Ea as $e,Fb as je,I as ht,J as yt,K as xt,N as be,X as Tt,Y as It,Z as Ce,b as me,c as G,ca as bt,d as ue,e as fe,g as ge,ha as Be,j as q,l as ve,ma as ke,p as he,s as ye,w as xe,ya as _e,za as Fe}from"./chunk-OOBMFFZN.js";import{$a as Ze,Ab as Ve,Ac as O,Ae as pt,Bb as d,Be as dt,Cb as se,Da as b,Db as u,Ea as C,Eb as ze,Ec as it,Ee as pe,Fa as Qe,Fe as Z,Gb as Ye,Hb as Je,Ib as Xe,Ie as mt,Je as ee,Kb as M,Kc as nt,Kf as gt,Lb as K,Lf as vt,M as Ee,Pd as rt,Ra as o,Rb as a,Re as de,Sa as H,Sb as s,Tb as Ne,Vd as Q,Wb as ce,Xe as te,Yd as at,Ye as ut,Zf as L,_e as ft,_f as U,a as Ke,ab as g,ac as et,ae as le,bb as re,cb as c,eb as ae,ha as oe,i as ne,ib as p,jb as l,ka as R,kb as v,lb as E,ld as ot,ma as De,mb as D,mc as Oe,me as P,ob as X,oe as st,pa as _,pc as N,pd as A,qa as y,qb as F,qe as ct,r as Se,ra as J,rb as w,rd as B,s as We,sa as T,se as lt,ta as h,tc as tt,ub as V,uc as W,we as Ae,xa as S,xb as Me,ya as x,yb as Le,yf as $,zb as Re,zd as k,zf as j}from"./chunk-M6I5A6DT.js";var Ft=()=>({cxRoute:"forgotPassword"}),wt=t=>({label:t});function Pt(t,e){t&1&&v(0,"cx-spinner",10)}function $t(t,e){if(t&1&&(v(0,"cx-form-errors",11),a(1,"cxTranslate")),t&2){let f=w();c("translationParams",K(4,wt,s(1,2,"loginForm.emailAddress.label")))("control",f.form.get("userId"))}}function jt(t,e){if(t&1&&v(0,"cx-form-errors",12),t&2){let f=w();c("control",f.form.get("userId"))}}function Ut(t,e){if(t&1&&(v(0,"cx-form-errors",11),a(1,"cxTranslate")),t&2){let f=w();c("translationParams",K(4,wt,s(1,2,"loginForm.password.label")))("control",f.form.get("password"))}}function Gt(t,e){if(t&1&&v(0,"cx-form-errors",12),t&2){let f=w();c("control",f.form.get("password"))}}function qt(t,e){t&1&&(p(0,"abbr",14),a(1,"cxTranslate"),d(2,"*"),l()),t&2&&V("title",s(1,1,"common.required"))}function Ht(t,e){t&1&&g(0,qt,3,3,"abbr",13),t&2&&c("cxFeature","a11yRequiredAsterisks")}var Kt=()=>({cxRoute:"register"}),Wt=()=>({cxRoute:"checkoutLogin"});function Qt(t,e){if(t&1){let f=X();E(0),p(1,"button",3),F("click",function(){b(f);let i=w();return C(i.navigateTo(i.loginAsGuest?"checkoutLogin":"register"))}),d(2),a(3,"cxTranslate"),l(),D()}if(t&2){let f=w();o(),c("ngClass",f.loginAsGuest?"btn-guest":"btn-register"),o(),u(" ",s(3,2,f.loginAsGuest?"loginForm.guestCheckout":"loginForm.register")," ")}}function Zt(t,e){t&1&&(E(0),p(1,"a",5),a(2,"cxUrl"),d(3),a(4,"cxTranslate"),l(),D()),t&2&&(o(),c("routerLink",s(2,2,M(6,Kt))),o(2),se(s(4,4,"loginForm.register")))}function zt(t,e){t&1&&(E(0),p(1,"a",6),a(2,"cxUrl"),d(3),a(4,"cxTranslate"),l(),D()),t&2&&(o(),c("routerLink",s(2,2,M(6,Wt))),o(2),se(s(4,4,"loginForm.guestCheckout")))}function Yt(t,e){if(t&1&&(E(0),g(1,Zt,5,7,"ng-container",4)(2,zt,5,7,"ng-container",4),D()),t&2){let f=w();o(),c("ngIf",!f.loginAsGuest),o(),c("ngIf",f.loginAsGuest)}}var Jt=t=>({name:t}),St=()=>({cxRoute:"login"});function Xt(t,e){if(t&1&&(E(0),p(1,"div",2),d(2),a(3,"cxTranslate"),l(),v(4,"cx-page-slot",3),D()),t&2){let f=e.ngIf;o(2),u(" ",Ne(3,1,"miniLogin.userGreeting",K(4,Jt,f.name))," ")}}function ei(t,e){t&1&&(p(0,"a",4),a(1,"cxUrl"),d(2),a(3,"cxTranslate"),l()),t&2&&(c("routerLink",s(1,2,M(6,St))),o(2),se(s(3,4,"miniLogin.signInRegister")))}var ti=()=>({cxRoute:"logout"});function ii(t,e){if(t&1&&(E(0),p(1,"div",2),d(2),l(),p(3,"a",3),a(4,"cxUrl"),d(5),a(6,"cxTranslate"),l(),D()),t&2){let f=e.ngIf;o(2),ze("",f.title,"",f.name,""),o(),c("routerLink",s(4,4,M(8,ti))),o(2),u("",s(6,6,"myAccountV2User.signOut")," ")}}function ni(t,e){t&1&&v(0,"cx-spinner",11)}function oi(t,e){t&1&&(p(0,"p",12),d(1),a(2,"cxTranslate"),l()),t&2&&(o(),u(" ",s(2,1,"formLegend.required")," "))}function ri(t,e){}function ai(t,e){}function si(t,e){t&1&&(p(0,"abbr",14),a(1,"cxTranslate"),d(2,"*"),l()),t&2&&V("title",s(1,1,"common.required"))}function ci(t,e){t&1&&g(0,si,3,3,"abbr",13),t&2&&c("cxFeature","a11yRequiredAsterisks")}var li=["noReceiveCodeLink"],pi=["resendLink"],di=t=>({"disabled-link":t}),mi=t=>({waitTime:t});function ui(t,e){t&1&&v(0,"cx-spinner",19)}function fi(t,e){if(t&1&&(E(0),d(1),a(2,"cxTranslate"),D()),t&2){let f=w();o(),u(" ",Ne(2,1,"verificationTokenForm.sendRateLime",K(4,mi,f.waitTime))," ")}}var Ue=(()=>{let e=class e{constructor(n,i,r){this.auth=n,this.globalMessage=i,this.winRef=r,this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(R(m=>{let I=this.winRef.nativeWindow?.history?.state?.newUid;I&&this.form.patchValue({userId:I}),m===!0?this.form.disable():this.form.enable()})),this.form=new ge({userId:new q("",[G.required,je.emailValidator]),password:new q("",G.required)})}login(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0),Se(this.auth.loginWithCredentials(this.form.value.userId.toLowerCase(),this.form.value.password)).pipe(De(this.auth.isUserLoggedIn()),R(([n,i])=>this.onSuccess(i))).subscribe()}onSuccess(n){n&&(this.globalMessage.remove(pe.MSG_TYPE_ERROR),this.form.reset()),this.busy$.next(!1)}};e.\u0275fac=function(i){return new(i||e)(T(P),T(Z),T(Q))},e.\u0275prov=_({token:e,factory:e.\u0275fac});let t=e;return t})(),gi=(()=>{let e=class e{constructor(n){this.service=n,this.form=this.service.form,this.isUpdating$=this.service.isUpdating$,this.style=!0}onSubmit(){this.service.login()}};e.\u0275fac=function(i){return new(i||e)(H(Ue))},e.\u0275cmp=S({type:e,selectors:[["cx-login-form"]],hostVars:2,hostBindings:function(i,r){i&2&&ae("user-form",r.style)},decls:29,vars:34,consts:[["requiredAsterisk",""],["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"label-content"],["required","true","type","email","formControlName","userId",1,"form-control",3,"placeholder"],[3,"translationParams","control",4,"cxFeature"],[3,"control",4,"cxFeature"],["required","true","type","password","formControlName","password","cxPasswordVisibilitySwitch","",1,"form-control",3,"placeholder"],[1,"btn-link",3,"routerLink"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"overlay"],[3,"translationParams","control"],[3,"control"],["class","text-decoration-none",3,"title",4,"cxFeature"],[1,"text-decoration-none",3,"title"]],template:function(i,r){if(i&1){let m=X();g(0,Pt,1,0,"cx-spinner",1),a(1,"async"),p(2,"form",2),F("ngSubmit",function(){return b(m),C(r.onSubmit())}),p(3,"label")(4,"span",3),d(5),a(6,"cxTranslate"),l(),v(7,"input",4),a(8,"cxTranslate"),g(9,$t,2,6,"cx-form-errors",5)(10,jt,1,1,"cx-form-errors",6),l(),p(11,"label")(12,"span",3),d(13),a(14,"cxTranslate"),l(),v(15,"input",7),a(16,"cxTranslate"),a(17,"cxTranslate"),g(18,Ut,2,6,"cx-form-errors",5)(19,Gt,1,1,"cx-form-errors",6),l(),p(20,"a",8),a(21,"cxUrl"),d(22),a(23,"cxTranslate"),l(),p(24,"button",9),d(25),a(26,"cxTranslate"),l()(),g(27,Ht,1,1,"ng-template",null,0,ce)}i&2&&(c("ngIf",s(1,15,r.isUpdating$)),o(2),c("formGroup",r.form),o(3),u(" ",s(6,17,"loginForm.emailAddress.label")," "),o(2),V("placeholder",s(8,19,"loginForm.emailAddress.placeholder")),o(2),c("cxFeature","formErrorsDescriptiveMessages"),o(),c("cxFeature","!formErrorsDescriptiveMessages"),o(3),u(" ",s(14,21,"loginForm.password.label")," "),o(2),V("placeholder",s(16,23,"loginForm.password.placeholder")),re("aria-label",s(17,25,"loginForm.password.placeholder")),o(3),c("cxFeature","formErrorsDescriptiveMessages"),o(),c("cxFeature","!formErrorsDescriptiveMessages"),o(),c("routerLink",s(21,27,M(33,Ft))),o(2),u(" ",s(23,29,"loginForm.forgotPassword")," "),o(2),c("disabled",r.form.disabled),o(),u(" ",s(26,31,"loginForm.signIn")," "))},dependencies:[N,ve,me,ue,fe,xe,he,ye,A,_e,Ce,Pe,de,W,$,L],encapsulation:2,changeDetection:0});let t=e;return t})(),vi=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({providers:[k({cmsComponents:{ReturningCustomerLoginComponent:{component:gi,guards:[ee],providers:[{provide:Ue,useClass:Ue,deps:[P,Z,Q]}]}}})],imports:[O,Te,Ie,B,j,U,Fe,ke,$e,te]});let t=e;return t})(),hi=(()=>{let e=class e{constructor(n){this.activatedRoute=n,this.loginAsGuest=!1,this.routingService=h(le,{optional:!0})}ngOnInit(){this.loginAsGuest=this.activatedRoute.snapshot.queryParams.forced}navigateTo(n){this.routingService?.go({cxRoute:n})}};e.\u0275fac=function(i){return new(i||e)(H(ot))},e.\u0275cmp=S({type:e,selectors:[["cx-login-register"]],decls:6,vars:5,consts:[[1,"register"],[1,"cx-section-title"],[4,"cxFeature"],[1,"btn","btn-block","btn-secondary",3,"click","ngClass"],[4,"ngIf"],[1,"btn","btn-block","btn-secondary","btn-register",3,"routerLink"],[1,"btn","btn-block","btn-secondary","btn-guest",3,"routerLink"]],template:function(i,r){i&1&&(p(0,"div",0)(1,"p",1),d(2),a(3,"cxTranslate"),l(),g(4,Qt,4,4,"ng-container",2)(5,Yt,3,2,"ng-container",2),l()),i&2&&(o(2),u(" ",s(3,3,"loginForm.dontHaveAccount")," "),o(2),c("cxFeature","a11yUseButtonsForBtnLinks"),o(),c("cxFeature","!a11yUseButtonsForBtnLinks"))},dependencies:[Oe,N,A,de,$,L],encapsulation:2});let t=e;return t})(),yi=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({providers:[k({cmsComponents:{ReturningCustomerRegisterComponent:{component:hi,guards:[ee]}}})],imports:[O,B,j,Be,U,te]});let t=e;return t})(),Et=(()=>{let e=class e{constructor(n,i){this.auth=n,this.userAccount=i,ut("a11yMyAccountLinkOutline")}ngOnInit(){this.user$=this.auth.isUserLoggedIn().pipe(oe(n=>n?this.userAccount.get():We(void 0)))}};e.\u0275fac=function(i){return new(i||e)(H(P),H(we))},e.\u0275cmp=S({type:e,selectors:[["cx-login"]],decls:4,vars:4,consts:[["login",""],[4,"ngIf","ngIfElse"],[1,"cx-login-greet"],["id","account-nav","position","HeaderLinks"],["role","link",3,"routerLink"]],template:function(i,r){if(i&1&&(g(0,Xt,5,6,"ng-container",1),a(1,"async"),g(2,ei,4,7,"ng-template",null,0,ce)),i&2){let m=Ve(3);c("ngIf",s(1,2,r.user$))("ngIfElse",m)}},dependencies:[N,A,bt,W,$,L],encapsulation:2});let t=e;return t})(),xi=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({providers:[k({cmsComponents:{LoginComponent:{component:Et}}})],imports:[O,B,j,Be,U]});let t=e;return t})(),Ti=(()=>{let e=class e extends Et{};e.\u0275fac=(()=>{let n;return function(r){return(n||(n=Qe(e)))(r||e)}})(),e.\u0275cmp=S({type:e,selectors:[["cx-my-account-v2-user"]],features:[Ze],decls:3,vars:3,consts:[[1,"cx-my-account-v2-user"],[4,"ngIf"],[1,"cx-name"],[1,"cx-sign-out",3,"routerLink"]],template:function(i,r){i&1&&(p(0,"div",0),g(1,ii,7,9,"ng-container",1),a(2,"async"),l()),i&2&&(o(),c("ngIf",s(2,1,r.user$)))},dependencies:[N,A,W,$,L],encapsulation:2});let t=e;return t})(),Ii=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({providers:[k({cmsComponents:{MyAccountViewUserComponent:{component:Ti,guards:[mt]}}})],imports:[O,B,j,U]});let t=e;return t})(),Dt="LOGIN",bi=(()=>{let e=class e{constructor(){this.routingService=h(le),this.verificationTokenFacade=h(z),this.winRef=h(Q),this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(R(n=>{let i=this.winRef.nativeWindow?.history?.state?.newUid;i&&this.form.patchValue({userId:i}),n===!0?this.form.disable():this.form.enable()})),this.form=new ge({userId:new q("",[G.required,je.emailValidator]),password:new q("",G.required)}),this.style=!0}onSubmit(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0);let n=this.collectDataFromLoginForm();this.verificationTokenFacade.createVerificationToken(n).subscribe({next:i=>this.goToVerificationTokenForm(i,n),error:()=>this.busy$.next(!1),complete:()=>this.onCreateVerificationTokenComplete()})}goToVerificationTokenForm(n,i){this.routingService.go({cxRoute:"verifyToken"},{state:{loginId:i.loginId,password:i.password,tokenId:n.tokenId,expiresIn:n.expiresIn}})}onCreateVerificationTokenComplete(){this.form.reset(),this.busy$.next(!1)}collectDataFromLoginForm(){return{loginId:this.form.value.userId.toLowerCase(),password:this.form.value.password,purpose:Dt}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=S({type:e,selectors:[["cx-otp-login-form"]],hostVars:2,hostBindings:function(i,r){i&2&&ae("user-form",r.style)},decls:30,vars:35,consts:[["requiredAsterisk",""],["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],["class","form-legend",4,"cxFeature"],[1,"label-content"],[3,"ngTemplateOutlet"],["required","true","type","email","formControlName","userId",1,"form-control",3,"placeholder"],[3,"control"],["required","true","type","password","formControlName","password","cxPasswordVisibilitySwitch","",1,"form-control",3,"placeholder"],[1,"btn-link",3,"routerLink"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"overlay"],[1,"form-legend"],["class","text-decoration-none",3,"title",4,"cxFeature"],[1,"text-decoration-none",3,"title"]],template:function(i,r){if(i&1){let m=X();g(0,ni,1,0,"cx-spinner",1),a(1,"async"),p(2,"form",2),F("ngSubmit",function(){return b(m),C(r.onSubmit())}),g(3,oi,3,3,"p",3),p(4,"label")(5,"span",4),d(6),a(7,"cxTranslate"),g(8,ri,0,0,"ng-template",5),l(),v(9,"input",6),a(10,"cxTranslate"),v(11,"cx-form-errors",7),l(),p(12,"label")(13,"span",4),d(14),a(15,"cxTranslate"),g(16,ai,0,0,"ng-template",5),l(),v(17,"input",8),a(18,"cxTranslate"),a(19,"cxTranslate"),v(20,"cx-form-errors",7),l(),p(21,"a",9),a(22,"cxUrl"),d(23),a(24,"cxTranslate"),l(),p(25,"button",10),d(26),a(27,"cxTranslate"),l()(),g(28,ci,1,1,"ng-template",null,0,ce)}if(i&2){let m=Ve(29);c("ngIf",s(1,16,r.isUpdating$)),o(2),c("formGroup",r.form),o(),c("cxFeature","a11yRequiredAsterisks"),o(3),u(" ",s(7,18,"loginForm.emailAddress.label")," "),o(2),c("ngTemplateOutlet",m),o(),V("placeholder",s(10,20,"loginForm.emailAddress.placeholder")),o(2),c("control",r.form.get("userId")),o(3),u(" ",s(15,22,"loginForm.password.label")," "),o(2),c("ngTemplateOutlet",m),o(),V("placeholder",s(18,24,"loginForm.password.placeholder")),re("aria-label",s(19,26,"loginForm.password.placeholder")),o(3),c("control",r.form.get("password")),o(),c("routerLink",s(22,28,M(34,Ft))),o(2),u(" ",s(24,30,"loginForm.forgotPassword")," "),o(2),c("disabled",r.form.disabled),o(),u(" ",s(27,32,"loginForm.signIn")," ")}},dependencies:[N,tt,ve,me,ue,fe,xe,he,ye,A,_e,Ce,Pe,de,W,$,L],encapsulation:2,changeDetection:0});let t=e;return t})(),Ci=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({providers:[k({cmsComponents:{ReturningCustomerOTPLoginComponent:{component:bi,guards:[ee]}}})],imports:[O,Te,Ie,B,j,U,Fe,ke,$e,te]});let t=e;return t})(),ki=(()=>{let e=class e{constructor(n){this.launchDialogService=n,this.VERIFICATION_TOKEN_DIALOG_ACTION=Ct,this.focusConfig={trap:!0,block:!0,autofocus:!0,focusOnEscape:!0}}closeModal(n){this.launchDialogService.closeDialog(n)}};e.\u0275fac=function(i){return new(i||e)(H(be))},e.\u0275cmp=S({type:e,selectors:[["cx-verification-token-dialog"]],decls:29,vars:22,consts:[["role","dialog",1,"cx-verification-token-dialog","cx-modal-container","cx-asm-dialog",3,"esc","cxFocus"],[1,"cx-modal-content"],[1,"cx-dialog-header","modal-header"],[1,"info-icon"],["type","INFO"],["id","verification-token-dialog-title",1,"title","modal-title"],[1,"spliter"],[1,"cx-dialog-body","modal-body"],[1,"cx-dialog-row"],[1,"cx-dialog-item"],[1,"cx-dialog-footer","modal-footer"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,r){i&1&&(p(0,"div",0),F("esc",function(){return r.closeModal(r.VERIFICATION_TOKEN_DIALOG_ACTION.OK)}),p(1,"div",1)(2,"div",2)(3,"div")(4,"span",3),v(5,"cx-icon",4),l(),p(6,"span",5),d(7),a(8,"cxTranslate"),l()()(),v(9,"hr",6),p(10,"div",7)(11,"div",8)(12,"div",9),d(13),a(14,"cxTranslate"),l(),p(15,"div",9),d(16),a(17,"cxTranslate"),l(),p(18,"div",9),d(19),a(20,"cxTranslate"),l(),p(21,"div",9),d(22),a(23,"cxTranslate"),l()()(),p(24,"div",10)(25,"button",11),a(26,"cxTranslate"),F("click",function(){return r.closeModal(r.VERIFICATION_TOKEN_DIALOG_ACTION.OK)}),d(27),a(28,"cxTranslate"),l()()()()),i&2&&(c("cxFocus",r.focusConfig),o(7),u(" ",s(8,8,"verificationTokenDialog.title")," "),o(6),u(" ",s(14,10,"verificationTokenDialog.noReceiveCode")," "),o(3),u(" ",s(17,12,"verificationTokenDialog.contentLine1")," "),o(3),u(" ",s(20,14,"verificationTokenDialog.contentLine2")," "),o(3),u(" ",s(23,16,"verificationTokenDialog.contentLine3")," "),o(3),re("aria-label",s(26,18,"verificationTokenDialog.ok")),o(2),u(" ",s(28,20,"verificationTokenDialog.close")," "))},dependencies:[ht,Tt,L],encapsulation:2});let t=e;return t})(),_i={launch:{ACCOUNT_VERIFICATION_TOKEN:{inlineRoot:!0,component:ki,dialogType:xt.DIALOG}}},Fi=1e4,Ge=(()=>{let e=class e{constructor(){this.globalMessage=h(Z),this.verificationTokenFacade=h(z),this.auth=h(P),this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(R(n=>{n===!0?this.form.disable():this.form.enable()})),this.form=new ge({tokenId:new q("",[G.required]),tokenCode:new q("",[G.required])})}login(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0),Se(this.auth.otpLoginWithCredentials(this.form.value.tokenId,this.form.value.tokenCode)).pipe(De(this.auth.isUserLoggedIn()),R(([n,i])=>this.onSuccess(i))).subscribe()}displayMessage(n,i){this.globalMessage.add({key:n,params:i},pe.MSG_TYPE_CONFIRMATION,Fi)}createVerificationToken(n,i,r){return this.verificationTokenFacade.createVerificationToken({loginId:n,password:i,purpose:r})}onSuccess(n){n&&(this.globalMessage.remove(pe.MSG_TYPE_ERROR),this.form.reset()),this.busy$.next(!1)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_({token:e,factory:e.\u0275fac});let t=e;return t})(),wi=(()=>{let e=class e{constructor(){this.service=h(Ge),this.launchDialogService=h(be),this.cdr=h(et),this.routingService=h(le),this.waitTime=60,this.form=this.service.form,this.isUpdating$=this.service.isUpdating$,this.style=!0,this.isResendDisabled=!0}ngOnInit(){history.state&&(this.tokenId=history.state.tokenId,this.password=history.state.password,this.target=history.state.loginId,history.pushState({tokenId:"",password:"",loginId:""},"verifyToken"),!this.target||!this.password||!this.tokenId?(this.service.displayMessage("verificationTokenForm.needInputCredentials",{}),this.routingService.go(["/login"])):(this.startWaitTimeInterval(),this.service.displayMessage("verificationTokenForm.createVerificationToken",{target:this.target})))}onSubmit(){this.service.login()}resendOTP(){this.isResendDisabled=!0,this.resendLink.nativeElement.tabIndex=-1,this.resendLink.nativeElement.blur(),this.waitTime=60,this.startWaitTimeInterval(),this.service.createVerificationToken(this.target,this.password,Dt).subscribe({next:n=>this.tokenId=n.tokenId,complete:()=>this.service.displayMessage("verificationTokenForm.createVerificationToken",{target:this.target})})}startWaitTimeInterval(){let n=setInterval(()=>{this.waitTime--,this.cdr.detectChanges(),this.waitTime<=0&&(clearInterval(n),this.isResendDisabled=!1,this.resendLink.nativeElement.tabIndex=0,this.cdr.detectChanges())},1e3)}openInfoDailog(){this.launchDialogService.openDialogAndSubscribe("ACCOUNT_VERIFICATION_TOKEN",this.element)}onOpenInfoDailogKeyDown(n){(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),this.openInfoDailog())}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=S({type:e,selectors:[["cx-verification-token-form"]],viewQuery:function(i,r){if(i&1&&(Me(li,5),Me(pi,5)),i&2){let m;Le(m=Re())&&(r.element=m.first),Le(m=Re())&&(r.resendLink=m.first)}},hostVars:2,hostBindings:function(i,r){i&2&&ae("user-form",r.style)},decls:35,vars:36,consts:[["resendLink",""],["noReceiveCodeLink",""],["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"label-content"],["required","true","formControlName","tokenCode","aria-describedby","tokenInputHint",1,"form-control",3,"placeholder"],[3,"control"],["id","tokenInputHint",1,"cx-visually-hidden"],["type","hidden","formControlName","tokenId",3,"ngModelChange","ngModel"],[1,"resend-link-text"],[1,"left-text"],["role","timer","aria-live","polite","aria-atomic","true"],["role","button","tabindex","-1",1,"btn-link",3,"keydown.enter","keydown.space","click","ngClass"],[4,"ngIf"],[1,"right-text"],["role","button","tabindex","0",1,"btn-link",3,"keydown","click"],[1,"verify-container"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"btn","btn-block","btn-secondary","btn-register",3,"routerLink"],[1,"overlay"]],template:function(i,r){if(i&1){let m=X();g(0,ui,1,0,"cx-spinner",2),a(1,"async"),p(2,"form",3),F("ngSubmit",function(){return b(m),C(r.onSubmit())}),p(3,"label")(4,"span",4),d(5),a(6,"cxTranslate"),l(),v(7,"input",5),a(8,"cxTranslate"),v(9,"cx-form-errors",6),l(),p(10,"span",7),d(11),a(12,"cxTranslate"),l(),p(13,"input",8),Xe("ngModelChange",function(Y){return b(m),Je(r.tokenId,Y)||(r.tokenId=Y),C(Y)}),l(),p(14,"div",9)(15,"div",10)(16,"span",11)(17,"a",12,0),F("keydown.enter",function(){return b(m),C(r.resendOTP())})("keydown.space",function(){return b(m),C(r.resendOTP())})("click",function(){return b(m),C(r.resendOTP())}),d(19),a(20,"cxTranslate"),l(),g(21,fi,3,6,"ng-container",13),l()(),p(22,"div",14)(23,"a",15,1),F("keydown",function(Y){return b(m),C(r.onOpenInfoDailogKeyDown(Y))})("click",function(){return b(m),C(r.openInfoDailog())}),d(25),a(26,"cxTranslate"),l()()(),p(27,"div",16)(28,"button",17),d(29),a(30,"cxTranslate"),l(),p(31,"button",18),a(32,"cxUrl"),d(33),a(34,"cxTranslate"),l()()()}i&2&&(c("ngIf",s(1,15,r.isUpdating$)),o(2),c("formGroup",r.form),o(3),u(" ",s(6,17,"verificationTokenForm.verificationCode.label")," "),o(2),c("placeholder",s(8,19,"verificationTokenForm.verificationCode.placeholder")),o(2),c("control",r.form.get("tokenCode")),o(2),u(" ",s(12,21,"verificationTokenForm.tokenInputHint")," "),o(2),Ye("ngModel",r.tokenId),o(4),c("ngClass",K(33,di,r.isResendDisabled)),o(2),u(" ",s(20,23,"verificationTokenForm.resend")," "),o(2),c("ngIf",r.isResendDisabled),o(4),u(" ",s(26,25,"verificationTokenForm.noReceiveCode")," "),o(3),c("disabled",r.form.disabled),o(),u(" ",s(30,27,"verificationTokenForm.verify")," "),o(2),c("routerLink",s(32,29,M(35,St))),o(2),u(" ",s(34,31,"verificationTokenForm.back")," "))},dependencies:[Oe,N,ve,me,ue,fe,xe,he,ye,A,_e,Ce,W,$,L],encapsulation:2,changeDetection:0});let t=e;return t})(),Si=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({providers:[k({cmsComponents:{VerifyOTPTokenComponent:{component:wi,guards:[ee],providers:[{provide:Ge,useClass:Ge,deps:[P,Z,z,Q]}]}}}),k(_i)],imports:[O,Te,yt,Ie,B,j,It,U,Fe,ke,te]});let t=e;return t})(),Mt=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({imports:[xi,vi,Si,yi,Ii,Ci]});let t=e;return t})();var Vt=new J("UserAccountNormalizer"),cn=new J("UserAccountSerializer"),Nt=new J("VerificationTokenNormalizer"),Ot=new J("LoginFormSerializer"),ie=class{},He=(()=>{let e=class e{constructor(n){this.adapter=n}get(n){return this.adapter.load(n)}createVerificationToken(n){return this.adapter.createVerificationToken(n)}};e.\u0275fac=function(i){return new(i||e)(T(ie))},e.\u0275prov=_({token:e,factory:e.\u0275fac});let t=e;return t})(),Lt=(()=>{let e=class e{constructor(n,i,r){this.userAccountConnector=n,this.userIdService=i,this.query=r,this.userQuery=this.query.create(()=>this.userIdService.takeUserId(!0).pipe(oe(m=>this.userAccountConnector.get(m))),{reloadOn:[kt],resetOn:[dt,pt]})}getById(n){return this.userAccountConnector.get(n)}get(){return this.userQuery.get()}};e.\u0275fac=function(i){return new(i||e)(T(He),T(rt),T(vt))},e.\u0275prov=_({token:e,factory:e.\u0275fac});let t=e;return t})(),Rt=(()=>{let e=class e{constructor(){this.connector=h(He),this.command=h(gt),this.createVerificationTokenCommand=this.command.create(({verificationTokenCreation:n})=>this.connector.createVerificationToken(n))}createVerificationToken(n){return this.createVerificationTokenCommand.execute({verificationTokenCreation:n})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_({token:e,factory:e.\u0275fac});let t=e;return t})(),Ei=[Lt,{provide:we,useExisting:Lt},Rt,{provide:z,useExisting:Rt}],At=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({providers:[He,...Ei]});let t=e;return t})();var Di={backend:{occ:{endpoints:{user:"users/${userId}",createVerificationToken:"users/anonymous/verificationToken"}}}},Mi={"Content-Type":"application/json"},Li=(()=>{let e=class e{constructor(n,i,r){this.http=n,this.occEndpoints=i,this.converter=r,this.logger=h(at)}load(n){let i=this.occEndpoints.buildUrl("user",{urlParams:{userId:n}});return this.http.get(i).pipe(Ee(r=>{throw Ae(r,this.logger)}),this.converter.pipeable(Vt))}createVerificationToken(n){let i=this.occEndpoints.buildUrl("createVerificationToken"),r=ct.createHeader(st,!0,new it(Ke({},Mi)));return n=this.converter.convert(n,Ot),this.http.post(i,n,{headers:r}).pipe(Ee(m=>{throw Ae(m,this.logger)}),this.converter.pipeable(Nt))}};e.\u0275fac=function(i){return new(i||e)(T(nt),T(lt),T(ft))},e.\u0275prov=_({token:e,factory:e.\u0275fac});let t=e;return t})(),Bt=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({providers:[k(Di),{provide:ie,useClass:Li}]});let t=e;return t})();var Cn=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=y({imports:[At,Bt,Mt]});let t=e;return t})();export{Cn as UserAccountModule};
